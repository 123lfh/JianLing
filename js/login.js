if(location.href&&location.href.indexOf("qq.com")>=0){document.domain="qq.com"}namespace("LoginManager");defineconflict(["biz.dialog","ams.atm"],function(Dialog,ATM){var APPID={qqtang:21000107,fo:21000106,ffo:21000106,pet:21000109,sg:21000103,r2:21000105,xx:21000104,x5:21000125,speed:21000118,cf:21000124,dnf:21000127,nana:21000119,ava:21000128,sl:21000401,battle:21000111,kaixuan:21000112,tgame:21000113,st:21000114,game:21000115,gcs:21000108,pigpet:21000117,fcm:21000116,petbear:21000101,gamesafe:21000109,webgame:21000118,"ied-gameinfo":21000501,"default":21000501,gw:536013304},ROLEGAME=["qqtang","qqgame","fo","ffo","pet","sg","r2","xx","x5","speed","cf","dnf","ava","sl","xj","dm","bear"],comm={getGameId:function(s_url){var url=s_url||window.location.host,gameIds=url.replace(/(\w+?)\.qq\.com/gi,"$1"),gameIda=gameIds.split("."),gameId=gameIda[gameIda.length-1];return gameId==url?"":gameId},clearLOG_INFO_2:function(){if(option.iUseQQConnect&&"qc"==milo.cookie.get("acctype")){milo.cookie.clear("IED_LOG_INFO2_QC",location.host,"/")}else if("wg"==milo.cookie.get("acctype")){milo.cookie.clear("IED_LOG_INFO2_WG",location.host,"/")}{milo.cookie.clear("IED_LOG_INFO2","qq.com","/")}},getAppId:function(gameId){return isUndefined(APPID[gameId])?APPID["default"]:APPID[gameId]},getAppGameId:function(gameId){var gameId=gameId||this.getGameId();var _host="";var services=LoginManager._DATA.APPGAMEID;for(var i=0;i<services.length;i++){if(services[i]==gameId){_host=gameId;break}}if(!_host){var i=milo.randomInt(services.length);_host=services[i]}return _host},getS_URL:function(needReloadPage){return needReloadPage?window.location.href.replace(/#+.*$/,""):location.protocol+"//"+window.location.host+"/comm-htdocs/login/logincallback.htm"},getCheckLoginUrl:function(){var loginType=option.loginType;var loginTypeMap={0:location.protocol+"//login.game.qq.com/comm-cgi-bin/login/LoginReturnInfo.cgi",1:location.protocol+"//commwebgame.game.qq.com/comm-cgi-bin/login/LoginReturnInfo.cgi",2:"",3:location.protocol+"//ams.game.qq.com/ams/userLoginSvr"};{var loc=window.location.href;if(loc.indexOf("qq.com/server/")>=0){loginType="1"}}var url=loginTypeMap[loginType];if(!url){url=loginTypeMap["0"]}var acctype=milo.request("acctype")||milo.cookie.get("acctype");if("qc"==acctype||"wg"==acctype||milo.request("acctype")&&milo.request("openid")||milo.cookie.get("openid")&&milo.cookie.get("acctype")){url=loginTypeMap["3"]}return url},checkUserLogined:function(){var loginInfoStr=milo.cookie.get("IED_LOG_INFO2");if("qc"==milo.cookie.get("acctype")&&option.iUseQQConnect==1){loginInfoStr=milo.cookie.get("IED_LOG_INFO2_QC")}if("wg"==milo.cookie.get("acctype")){loginInfoStr=milo.cookie.get("IED_LOG_INFO2_WG")}if(!loginInfoStr){return false}var loginInfo=milo.unSerialize(loginInfoStr);if(milo.request("acctype")){if(milo.cookie.get("acctype")&&milo.cookie.get("openid")&&milo.cookie.get("access_token")){}else{comm.clearLOG_INFO_2();return false}}if(!loginInfo||!loginInfo.userUin&&!loginInfo.openid){comm.clearLOG_INFO_2();return false}var expire=Math.floor(milo.getSeverDateTime().getTime()/1e3)-loginInfo.userLoginTime>86400?true:false;if("wg"==milo.cookie.get("acctype")&&!(milo.cookie.get("openid")&&milo.cookie.get("access_token"))){expire=true}if("qc"==milo.cookie.get("acctype")&&!(milo.cookie.get("openid")&&milo.cookie.get("access_token"))){expire=true}if(expire){comm.clearLOG_INFO_2();return false}return true},callbackLoginInfo:function(methodName,callback){if(typeof window.loginFunction!="object"){window.loginFunction={}}window.loginFunction[methodName]=window[methodName]=function(IED_LOG_INFO2){var __tointer=1;if(comm.getCheckLoginUrl(comm.getGameId()).indexOf("//commwebgame.game.qq.com/comm-cgi-bin/login/LoginReturnInfo.cgi")>-1||comm.getCheckLoginUrl(comm.getGameId()).indexOf("//ams.game.qq.com/ams/userLoginSvr")>-1){__tointer=2}if(IED_LOG_INFO2.errorCode!=0&&IED_LOG_INFO2.errorCode!=-1){alert("\u8fd4\u56de\u7ed3\u679c\u51fa\u9519\uff0c\u9519\u8bef\u4fe1\u606f\u4e3a\uff1a"+IED_LOG_INFO2.errorStr);ATM.reportATM({toappid:1,tomoduletype:100,tointer:__tointer,toreturncode:1,businesstype:comm.getGameId(),result:IED_LOG_INFO2.errorCode,cgi:location.href,errormsg:IED_LOG_INFO2.errorStr});return}if(milo.request("acctype")!=""&&IED_LOG_INFO2.errorCode==-1){alert("\u60a8\u672a\u767b\u5f55\u6216\u767b\u5f55\u5df2\u8fc7\u671f\uff0c\u8bf7\u4ece\u6e38\u620f\u91cd\u65b0\u8fdb\u5165\u672c\u6d3b\u52a8");ATM.reportATM({toappid:1,tomoduletype:100,tointer:__tointer,toreturncode:1,businesstype:comm.getGameId(),result:IED_LOG_INFO2.errorCode,cgi:location.href,errormsg:IED_LOG_INFO2.errorStr});return}if(IED_LOG_INFO2.isLogin){var loginInfo=milo.cookie.get("IED_LOG_INFO2");if(loginInfo){loginInfo=milo.unSerialize(loginInfo)}else{loginInfo={}}if(IED_LOG_INFO2.loginType=="qq"||IED_LOG_INFO2.loginType=="wx"){loginInfo.userUin=IED_LOG_INFO2.openid}else{loginInfo.userUin=IED_LOG_INFO2.userUin}loginInfo.nickName=IED_LOG_INFO2.nickName;loginInfo.userLoginTime=IED_LOG_INFO2.userLoginTime;var value=milo.serialize(loginInfo);var acctype=milo.request("acctype");if(acctype=="weixin"){acctype="wx"}if(acctype!==""){milo.cookie.set("acctype",acctype,86400,"qq.com","/")}if(milo.request("appid")){milo.cookie.set("appid",milo.request("appid"),86400,"qq.com","/")}if(milo.request("openid")){milo.cookie.set("openid",milo.request("openid"),86400,"qq.com","/")}if(acctype=="wx"){if(milo.request("access_token")){milo.cookie.set("access_token",milo.request("access_token"),86400,"qq.com","/")}}else{if(milo.request("openkey")){milo.cookie.set("access_token",milo.request("openkey"),86400,"qq.com","/")}}if("qc"==IED_LOG_INFO2.loginType||"wg"==IED_LOG_INFO2.loginType){if("qc"==IED_LOG_INFO2.loginType){var logInfo={openid:IED_LOG_INFO2.openid,userUin:"",nickName:IED_LOG_INFO2.nickName,userLoginTime:IED_LOG_INFO2.userLoginTime,loginType:"qc",expires:86400};var value=milo.serialize(logInfo);milo.cookie.set("IED_LOG_INFO2_QC",value,0,location.host,"/")}else if("wg"==IED_LOG_INFO2.loginType){var logInfo={openid:IED_LOG_INFO2.openid,userUin:"",nickName:IED_LOG_INFO2.nickName,userLoginTime:IED_LOG_INFO2.userLoginTime,loginType:"wg",expires:86400};var value=milo.serialize(logInfo);var expires_in=IED_LOG_INFO2.expires_in||3600;milo.cookie.set("openid",IED_LOG_INFO2.openid,expires_in,location.host,"/");milo.cookie.set("access_token",IED_LOG_INFO2.access_token,expires_in,location.host,"/");milo.cookie.set("IED_LOG_INFO2_WG",value,0,location.host,"/")}}else{milo.cookie.set("IED_LOG_INFO2",value,0,"qq.com","/")}}else{comm.clearLOG_INFO_2()}if(typeof callback=="function"){callback(IED_LOG_INFO2)}ATM.reportATM({toappid:1,tomoduletype:100,tointer:__tointer,toreturncode:IED_LOG_INFO2.errorCode==0?0:1,businesstype:comm.getGameId(),result:IED_LOG_INFO2.errorCode,cgi:location.href,errormsg:IED_LOG_INFO2.errorStr})}},getUserUin:function(){var loginInfo=milo.cookie.get("IED_LOG_INFO2"),uin;if("qc"==milo.cookie.get("acctype")&&option.iUseQQConnect==1){loginInfo=milo.cookie.get("IED_LOG_INFO2_QC")}if("wg"==milo.cookie.get("acctype")){loginInfo=milo.cookie.get("IED_LOG_INFO2_WG")}if(loginInfo){loginInfo=milo.unSerialize(loginInfo);uin=loginInfo.userUin;return!!uin&&!isNaN(uin)?uin:""}else{return""}},getNickName:function(){var loginInfo=milo.cookie.get("IED_LOG_INFO2"),nickName;if("qc"==milo.cookie.get("acctype")&&option.iUseQQConnect==1){loginInfo=milo.cookie.get("IED_LOG_INFO2_QC")}if("wg"==milo.cookie.get("acctype")){loginInfo=milo.cookie.get("IED_LOG_INFO2_WG")}if(loginInfo){loginInfo=milo.unSerialize(loginInfo);nickName=loginInfo.nickName;return nickName?decodeURIComponent(nickName):""}else{return""}},wxUserInfoCache:{},getWxUserInfo:function(openid,access_token){var id=openid+"_"+access_token;if(this.wxUserInfoCache[id]){return this.wxUserInfoCache[id]}else{return null}},storeWxUserInfo:function(openid,access_token,info){var id=openid+"_"+access_token;this.wxUserInfoCache[id]=info},userFaceCache:{},getUserFaceData:function(id){var self=this;if(!this.userFaceCache[id]){return null}else{return this.userFaceCache[id]}},storeUserFace:function(id,data){if(id&&data){this.userFaceCache[id]=data}}},logWin={openLoginDiv:function(opt){var option={left:.5,top:.5,src:""};extend(option,opt);var _div=g("loginDiv");if(!_div){_div=document.createElement("div");_div.id="loginDiv";_div.style.height="368px";_div.style.width="622px";_div.style.border="0px";_div.style.padding="0px";_div.style.margin="0px";_div.style.position="absolute";_div.style.zIndex="100002";_div.style.top="20%";_div.style.left="30%";_div.style.display="none";var oIFrame=document.createElement("iframe");oIFrame.id="loginIframe";oIFrame.name="loginIframe";oIFrame.frameborder="0";oIFrame.scrolling="no";oIFrame.width="100%";oIFrame.height="100%";oIFrame.frameBorder="0";_div.appendChild(oIFrame);document.body.appendChild(_div)}var _iframe=g("loginIframe");_iframe.setAttribute("src",option.src);_div.style.display="none";return _div},getLoginDiv:function(){var _div=g("loginDiv");if(!_div){_div=this.openLoginDiv()}var _src=g("loginIframe").getAttribute("src");if(!_src){_div.style.display="none"}return _div}},option={gameId:"",appId:"",onlyCookie:false,needMaskDiv:true,needReloadPage:true,loginType:0,loginedDiv:"logined",unloginDiv:"unlogin",userinfoSpan:"login_qq_span",userheadimg:"ams_user_headimg",loginDivOffset:{left:.5,top:.5},freshWin:"",jumpUrl:"",iUseQQConnect:typeof window.iUseQQConnect!="undefined"?window.iUseQQConnect:0,oQQConnectParams:{appId:"101491592",scope:"get_user_info",state:"STATE",redirect_uri:"https://milo.qq.com/comm-htdocs/login/qc_redirect.html"},oWegameParams:{client_id:"7019928239",redirect_uri:"https://milo.qq.com/comm-htdocs/login/wegame_redirect.html",rail_game_id:"2000108",scope:"openid profile",state:"STATE",lang:"ZH_CN"}},wegameFrame={isReady:false,$frame:null,init:function(callback){var self=this;if(self.isReady){isFunction(callback)&&callback();return}var tpl='<div class="wegameLogin">					<div class="wegameLoginCover"></div>					<div class="wegameLoginContent">						<div>							<div class="wegameLoginIcon"></div>							<a class="wegameClose" href="javascript:void(0)">\xd7</a>						</div>						<iframe class="wegameloginframe" frameborder="0" src=""></iframe>					</div>				</div>';need("util.jquery",function($){self.$frame=$(tpl).appendTo(document.getElementsByTagName("body")[0]);var style='<style type="text/css">.wegameloginframe{width:100%;height:600px;overflow:hidden;border:0px solid white}.wegameLogin{position:fixed;width:100%;height:100%;left:0px;top:0px}.wegameLoginCover{position:absolute;width:100%;height:100%;left:0px;top:0px;z-index:9999;background-color:white;opacity:0.7;filter:alpha(opacity=70)}.wegameLoginContent{width:800px;height:600px;background-color:#fff;overflow:hidden;position:absolute;left:50%;top:50%;z-index:10000;margin-left:-400px;margin-top:-300px;border:1px solid #bfbfbf;box-shadow:0 0 10px rgba(0,0,0,.3)}.wegameLoginContent>div{height:30px;width:100%;background-color:none;font-size:18px}.wegameLoginContent>div.wegameLoginTitle{width:100%;background-color:#0e0e0e}div.wegameLoginIcon{display:none}.wegameLoginTitle>div.wegameLoginIcon{display:block;float:left;width:239px;height:60px;background:url(https://api.rail.tgp.qq.com/web/oauth2.0/login/images/wegame-logo-m.png) no-repeat center;margin-left:10px}.wegameLoginContent>div span{color:white;display:inline-block;line-height:30px;padding:0px 5px}.wegameLoginContent>div a{float:right;line-height:30px;text-decoration:none;color:white;font-weight:bold;font-size:25px;width:30px;text-align:center;cursor:pointer}.wegameLoginContent>div a:hover{color:#f57272}.wegameLoginContent>div{position:absolute;z-index:100001;right:0px;width:30px;top:0px;height:60px;text-align:center}.wegameLoginContent>div a{line-height:55px;display:inline-block}</style>';$(style).appendTo(document.getElementsByTagName("head")[0]);self.$frame.find("a.wegameClose").bind("click",function(){self.close()});self.isReady=true;isFunction(callback)&&callback()})},close:function(){this.$frame.hide()},show:function(url){var self=this;this.init(function(){self.showTitle(false);self.$frame.find("iframe").attr("src",url);self.$frame.show()})},showTitle:function(isShow){var self=this;if(isShow){self.$frame.find(".wegameLoginContent>div").addClass("wegameLoginTitle")}else{self.$frame.find(".wegameLoginContent>div").removeClass("wegameLoginTitle")}}},qqConnectFrame={isReady:false,$frame:null,init:function(callback){var self=this;if(self.isReady){isFunction(callback)&&callback();return}var tpl='<div class="qConnectLogin">					<div class="qConnectLoginCover"></div>					<div class="qConnectLoginContent">						<div>							<a class="qConnectClose" href="javascript:void(0)">\xd7</a>						</div>						<iframe class="loginframe" frameborder="0" src=""></iframe>					</div>				</div>';need("util.jquery",function($){self.$frame=$(tpl).appendTo(document.getElementsByTagName("body")[0]);var style='<style type="text/css">.loginframe{width:100%;height:400px;overflow:hidden;border:0px solid white}.qConnectLogin{position:fixed;width:100%;height:100%;left:0px;top:0px}.qConnectLoginCover{position:absolute;width:100%;height:100%;left:0px;top:0px;z-index:9999;background-color:white;opacity:0.7;filter:alpha(opacity=70)}.qConnectLoginContent{width:752px;height:400px;background-color:#fff;overflow:hidden;position:absolute;left:50%;top:50%;z-index:10000;margin-left:-375px;margin-top:-220px;border:1px solid #bfbfbf;box-shadow:0 0 10px rgba(0,0,0,.3)}.qConnectLoginContent>div{height:30px;width:100%;background-color:#4fb7ec;font-size:18px}.qConnectLoginContent>div span{color:white;display:inline-block;line-height:30px;padding:0px 5px}.qConnectLoginContent>div a{float:right;line-height:30px;text-decoration:none;color:white;font-weight:bold;font-size:25px;width:30px;text-align:center;cursor:pointer}.qConnectLoginContent>div a:hover{color:#f57272}.qConnectLoginContent>div{position:absolute;z-index:100001;right:0px;width:30px;top:0px;height:48px;text-align:center}.qConnectLoginContent>div a{line-height:40px;display:inline-block}</style>';$(style).appendTo(document.getElementsByTagName("head")[0]);self.$frame.find("a.qConnectClose").bind("click",function(){self.close()});self.isReady=true;isFunction(callback)&&callback()})},close:function(){this.$frame.hide()},show:function(url){var self=this;this.init(function(){self.$frame.find("iframe").attr("src",url);self.$frame.show()})}},qcWxFrame={isReady:false,$frame:null,init:function(opt,callback){var self=this;if(self.isReady){isFunction(callback)&&callback();return}var tpl='<div class="qcwx-login" id="qcwx-login">					<div class="qcwx-login-cover"></div>					<div class="qcwx-login-frame qcwx-active-qc">						<div class="qcwx-tabs">							<a href="javascript:void(0)" class="qc-tab" data-tab="qc"><i class="ico-qc-logo"></i><span>QQ\u8d26\u53f7\u767b\u5f55</span></a>							<a href="javascript:void(0)" class="wx-tab" data-tab="wx"><i class="ico-wx-logo"></i><span>\u5fae\u4fe1\u8d26\u53f7\u767b\u5f55</span></a>							<a href="javascript:void(0)" class="qcwxtab-close">\xd7</a>						</div>						<div class="qcwx-tips">'+opt.topTips+'</div>						<div class="qcwx-frame">							<div id="qcwx-frame-qc-div" class="qcwx-frame-qc-div"><iframe src="" frameborder="0" class="qcwx-frame-qc"></iframe></div>							<div id="qcwx-frame-wx-div" class="qcwx-frame-wx-div"><iframe src="" frameborder="0" class="qcwx-frame-wx"></iframe></div>						</div>					</div>				</div>';need("util.jquery",function($){self.$frame=$(tpl).appendTo(document.getElementsByTagName("body")[0]);var style='<style type="text/css">.qcwx-login{position:fixed;width:100%;height:100%;left:0px;top:0px;display:none}.qcwx-login-cover{osition:absolute;width:100%;height:100%;left:0px;top:0px;z-index:9999;background-color:white;opacity:0.7;filter:alpha(opacity=70)}.qcwx-login-frame{width:750px;height:420px;background-color:white;overflow:hidden;position:absolute;left:50%;top:50%;z-index:10000;margin-left:-375px;margin-top:-240px;border:1px solid #bfbfbf;box-shadow:0 0 10px rgba(0,0,0,.3);border-radius:5px 5px 0px 0px}.qcwx-tabs{line-height:40px;position:absolute;z-index:100001;width:100%}.qcwx-tabs .qc-tab,.qcwx-tabs .wx-tab{cursor:pointer;display:inline-block;width:50%;float:left;text-align:center;font-size:18px;background-color:#f1f1f1;color:#b1b1b1;text-decoration:none}.qcwx-active-qc a.qc-tab{color:#fff;background-color:#51b7ec}.qcwx-active-wx a.wx-tab{color:#fff;background-color:#4ab218}.qcwx-tabs .qcwxtab-close{position:absolute;right:0px;top:0px;text-decoration:none;color:grey;font-size:25px;line-height:25px;display:inline-block;padding:0px 5px;border-width:0px 0px 1px 1px;border-style:solid}.qcwx-active-qc .qcwx-tabs .qcwxtab-close{border-color:#e0dcdc}.qcwx-active-wx .qcwx-tabs .qcwxtab-close{border-color:#8BC34A;color:#d4d2d2}.qcwx-tabs .qcwxtab-close:hover{font-weight:bold}.qcwx-tips{line-height:30px;font-size:14px;text-align:center;color:#a2a2a2;position:absolute;width:100%;top:40px;z-index:10001;background-color:#fff}.qcwx-frame{width:750px;height:410px;position:absolute;overflow:hidden}.qcwx-frame div{width:100%;height:100%;position:absolute;left:0px;top:0px;text-align:center;display:none}.qcwx-frame div iframe{width:100%;height:100%}.qcwx-active-qc div.qcwx-frame-qc-div{display:block}.qcwx-active-wx div.qcwx-frame-wx-div{display:block}i.ico-qc-logo,i.ico-wx-logo{display:inline-block;height:23px;vertical-align:middle;margin:0px 5px;margin-top:-4px;background:url(https://vm.gtimg.cn/tencentvideo/vstyle/web/common/style/img/login/sprite_login.png?d=0210&max_age=31104000)  no-repeat}i.ico-qc-logo{width:20px}i.ico-wx-logo{width:24px}.qcwx-active-wx i.ico-qc-logo{background-position:-180px -90px}.qcwx-active-wx i.ico-wx-logo{background-position:-250px -90px}.qcwx-active-qc i.ico-qc-logo{background-position:-200px -90px}.qcwx-active-qc i.ico-wx-logo{background-position:-220px -90px}div#qcwx-frame-wx-div{top:20px}</style>';$(style).appendTo(document.getElementsByTagName("head")[0]);self.$frame.find("a.qcwxtab-close").bind("click",function(){self.close()});self.$frame.find(".qc-tab,.wx-tab").bind("click",function(){var tab=$(this).attr("data-tab");self.$frame.find(".qcwx-login-frame").removeClass("qcwx-active-qc").removeClass("qcwx-active-wx").addClass("qcwx-active-"+tab)});self.isReady=true;isFunction(callback)&&callback()})},close:function(){this.$frame.hide()},show:function(qcUrl,wxOption,opt){var self=this;self.init(opt,function(){self.$frame.find("iframe.qcwx-frame-qc").attr("src",qcUrl);wxOption.innerStyle=true;wxOption.innerParentId="qcwx-frame-wx-div";LoginManager.loginByWx(wxOption);self.$frame.show()})}};cb={loginedCallback:function(){if(isDom(g(option.loginedDiv))){g(option.loginedDiv).style.display="block"}if(isDom(g(option.unloginDiv))){g(option.unloginDiv).style.display="none"}if(isDom(g(option.userinfoSpan))){g(option.userinfoSpan).innerHTML=milo.xss.filterWxNickName(comm.getUserUin()||comm.getNickName())}},unloginCallback:function(){if(isDom(g(option.loginedDiv))){g(option.loginedDiv).style.display="none"}if(isDom(g(option.unloginDiv))){g(option.unloginDiv).style.display="block"}}};LoginManager._getCheckLoginUrl=function(){return comm.getCheckLoginUrl()};LoginManager.isLogin=function(){return comm.checkUserLogined()};LoginManager.getUserUin=function(){var uin=comm.getUserUin();if(!uin){return""}var _realStr=milo.cookie.get("show_id");if(!_realStr){return uin}var _getQQStr=function(realStr){var len=realStr.length;if(len%2!=0){return""}var _qq="";for(var i=0;i<len;i+=2){_qq+=String.fromCharCode(parseInt(realStr.substr(i,2),16))}return _qq};var __uin=_getQQStr(_realStr);if(!isNaN(__uin)){return __uin}return uin};LoginManager.getUserFace=function(b){var acctype=milo.cookie.get("acctype")||"";if(/^(qc|wg)$/.test(acctype)){var face=comm.getUserFaceData(milo.cookie.get("openid"));if(face){isFunction(b)&&b(face)}else{var callback=b;var requestParam={openid:milo.cookie.get("openid"),access_token:milo.cookie.get("access_token"),appid:milo.cookie.get("appid"),acctype:milo.cookie.get("acctype"),refresh_token:milo.cookie.get("refresh_token")||""};var url=comm.getCheckLoginUrl();url=url+"?"+milo.serialize(requestParam);var callbackName="userFace_"+(new Date).getTime();window[callbackName]=function(userinfo){if(userinfo.errorCode==0){var face=userinfo.face;if(face){comm.storeUserFace(requestParam.openid,face);isFunction(callback)&&callback(face)}}else{isFunction(callback)&&callback("")}};url+="&callback="+callbackName;milo.loginStatus.clearAME(function(){loadScript(url,function(){})})}return}if("function"==typeof b){var a={isLogin:!1,userFace:location.protocol+"//imgcache.qq.com/ptlogin/v4/style/0/images/1.gif"};LoginManager.checkLogin(function(){a.isLogin=!0;var d=comm.getGameId(),d=comm.getAppId(d),c=comm.getUserUin();window.pt={};pt.setHeader=function(d){d[c]&&(a.userFace=d[c]);b(a)};var getUrl="http://ptlogin2.qq.com/getface?appid="+d+"&imgtype=3&encrytype=0&devtype=0&keytpye=0&uin="+c;if(location.protocol=="https:"){getUrl="https://ssl.ptlogin2.qq.com/getface?appid="+d+"&imgtype=3&encrytype=0&devtype=0&keytpye=0&uin="+c}milo.loader.loadScript(getUrl,function(){b(a)})},function(){b(a)})}};LoginManager.qcLogin=function(callback,opt,isQcWx){var self=this;var logOption={gameId:"",appId:"",needMaskDiv:true,needReloadPage:true,loginDivOffset:{left:.5,top:.5},msg:"\u6b63\u5728\u83b7\u53d6\u767b\u5f55\u4fe1\u606f\uff0c\u8bf7\u7a0d\u5019...",loginedCallback:null,type:"float",loginFrame:"loginHTMLFrame",css:"",s_url:""};if(typeof callback!="function"&&typeof callback=="object"){opt=callback;callback=null}extendLess(logOption,option);extend(logOption,opt);var qcOption=option.oQQConnectParams||{appId:"101491592",scope:"get_user_info",redirect_uri:"https://milo.qq.com/comm-htdocs/login/qc_redirect.html",state:"STATE"};if(logOption.oQQConnectParams){extend(qcOption,logOption.oQQConnectParams)}if(opt&&opt.needReloadPage){logOption.needReloadPage=opt.needReloadPage}else{logOption.needReloadPage=isFunction(callback)?false:logOption.needReloadPage}window.qqConnectCallback=function(codeOption){if(!codeOption||!codeOption.code){alert("\u62b1\u6b49\uff0c\u53c2\u6570\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55");if(isQcWx){qcWxFrame.close()}else{qqConnectFrame.close()}return}if(codeOption.state!=qcOption.state){alert("\u62b1\u6b49\uff0c\u6765\u6e90\u6821\u9a8c\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55");if(isQcWx){qcWxFrame.close()}else{qqConnectFrame.close()}return}var doCallbackName="doCallback_"+Math.ceil(1e4*Math.random());window[doCallbackName]=function(userInfo){if(0!=userInfo.errorCode){alert("\u62b1\u6b49\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55");if(isQcWx){qcWxFrame.close()}else{qqConnectFrame.close()}return}var logInfo={openid:milo.cookie.get("openid"),userUin:"",nickName:userInfo.nickName,userLoginTime:parseInt((new Date).getTime()/1e3),loginType:"qc",expires:86400};var value=milo.serialize(logInfo);milo.cookie.set("IED_LOG_INFO2_QC",value,0,location.host,"/");if(userInfo.face){comm.storeUserFace(logInfo.openid,userInfo.face)}if(!logOption.needReloadPage){if(isQcWx){qcWxFrame.close()}else{qqConnectFrame.close()}var isLogin=comm.checkUserLogined();if(isLogin){cb.loginedCallback();if(isFunction(callback))callback()}else{cb.unloginCallback()}}else{window.location.reload()}};need("util.jquery",function($){var params={a:"qcCodeToOpenId",qc_code:codeOption.code,appid:qcOption.appId,redirect_uri:qcOption.redirect_uri};$.ajax({url:location.protocol+"//ams.game.qq.com/ams/userLoginSvr?"+milo.serialize(params),type:"GET",dataType:"jsonp",success:function(retObj){if(0==retObj.iRet){var data=retObj;milo.cookie.set("openid",data.openid,86400,location.host,"/");milo.cookie.set("access_token",data.access_token,86400,location.host,"/");milo.cookie.set("appid",qcOption.appId,86400,location.host,"/");milo.cookie.set("acctype","qc",86400,location.host,"/");milo.loginStatus.clearAME(function(){loadScript(comm.getCheckLoginUrl(option.gameId)+"?callback="+doCallbackName+"&acctype="+"qc"+"&appid="+qcOption.appId+"&openid="+data.openid+"&access_token="+data.access_token+"&game="+comm.getGameId(),function(loaded){})})}else{self.logout(function(){alert(retObj.sMsg);if(isQcWx){qcWxFrame.close()}else{qqConnectFrame.close()}})}},error:function(){}})})};var loginUrl="https://graph.qq.com/oauth2.0/authorize?response_type=code";var loginOpt={state:qcOption.state,client_id:qcOption.appId,redirect_uri:qcOption.redirect_uri||"https://milo.qq.com/comm-htdocs/login/qc_redirect.html?parent_domain="+encodeURIComponent(location.protocol+"//"+location.host)};if(-1==loginOpt.redirect_uri.indexOf("parent_domain=")){loginOpt.redirect_uri+=(loginOpt.redirect_uri.indexOf("?")>-1?"&":"?")+"parent_domain="+encodeURIComponent(location.protocol+"//"+location.host)}loginUrl+="&"+milo.serialize(loginOpt);if(isQcWx){return loginUrl}else{qqConnectFrame.show(loginUrl)}};LoginManager.clearPtStatus=function(callback){milo.cookie.clear("uin","qq.com","/");milo.cookie.clear("skey","qq.com","/");milo.cookie.clear("luin","qq.com","/");milo.cookie.clear("lskey","qq.com","/");milo.cookie.clear("p_uin","qq.com","/");milo.cookie.clear("p_skey","qq.com","/");milo.cookie.clear("p_luin","qq.com","/");milo.cookie.clear("p_lskey","qq.com","/");milo.loginStatus.clearAME(function(){isFunction(callback)&&callback()},["uin","skey","luin","lskey","p_uin","p_skey","p_luin","p_lskey"])};LoginManager.loginByWegame=function(opt,callback){var self=this;var logOption={};extendLess(logOption,option);extendLess(logOption,opt);var wegameParams=option.oWegameParams||{client_id:"7019928239",redirect_uri:"https://milo.qq.com/comm-htdocs/login/wegame_redirect.html",rail_game_id:"2000108",scope:"openid profile",state:"STATE",lang:"ZH_CN"};if(opt.oWegameParams){extendLess(wegameParams,opt.oWegameParams)}if(opt&&opt.needReloadPage){logOption.needReloadPage=opt.needReloadPage}else{logOption.needReloadPage=isFunction(callback)?false:logOption.needReloadPage}var oldUin=milo.cookie.get("uin");window.wegameCallback=function(codeOption){wegameFrame.showTitle(true);console.log(codeOption);if(!codeOption||!codeOption.code){alert("\u62b1\u6b49\uff0c\u53c2\u6570\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55");wegameFrame.close();return}if(codeOption.state!=wegameParams.state){alert("\u62b1\u6b49\uff0c\u6765\u6e90\u6821\u9a8c\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55");wegameFrame.close();return}var wegameCallbackName="wegameCallback_"+Math.ceil(1e4*Math.random());window[wegameCallbackName]=function(userInfo){if(0!=userInfo.errorCode){alert("\u62b1\u6b49\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55");wegameFrame.close();return}if(oldUin&&milo.cookie.get("uin")&&oldUin!==milo.cookie.get("uin")){milo.cookie.clear("IED_LOG_INFO2","qq.com","/");self.clearPtStatus()}var logInfo={openid:milo.cookie.get("openid"),nickName:userInfo.nickName,userLoginTime:parseInt((new Date).getTime()/1e3),loginType:"wg",expires:86400};var value=milo.serialize(logInfo);milo.cookie.set("IED_LOG_INFO2_WG",value,0,location.host,"/");if(userInfo.face){comm.storeUserFace(logInfo.openid,userInfo.face)}if(!logOption.needReloadPage){wegameFrame.close();var isLogin=comm.checkUserLogined();if(isLogin){cb.loginedCallback();if(isFunction(callback))callback()}else{cb.unloginCallback()}}else{window.location.reload()}};need("util.jquery",function($){var params={a:"wgCodeToRailId",wg_code:codeOption.code,appid:wegameParams.client_id,redirect_uri:wegameParams.redirect_uri};$.ajax({url:location.protocol+"//ams.game.qq.com/ams/userLoginSvr?"+milo.serialize(params),type:"GET",dataType:"jsonp",success:function(retObj){if(0==retObj.iRet){var data=retObj;var expires_in=data.expires_in||3600;milo.cookie.set("openid",data.openid,expires_in,location.host,"/");milo.cookie.set("access_token",data.access_token,expires_in,location.host,"/");milo.cookie.set("appid",wegameParams.client_id,86400,location.host,"/");milo.cookie.set("acctype","wg",86400,location.host,"/");milo.cookie.set("refresh_token",data.refresh_token,86400,location.host,"/");var loginApi=location.protocol+"//ams.game.qq.com/ams/userLoginSvr";milo.loginStatus.clearAME(function(){loadScript(loginApi+"?callback="+wegameCallbackName+"&acctype="+"wg"+"&appid="+wegameParams.client_id+"&openid="+data.openid+"&access_token="+data.access_token,function(loaded){})})}else{self.logout(function(){alert(retObj.sMsg);wegameFrame.close()})}},error:function(){}})})};var loginUrl="https://api.rail.tgp.qq.com/web/oauth2.0/login/authorize?response_type=code";var loginOpt={redirect_type:"self",state:wegameParams.state,client_id:wegameParams.client_id,rail_game_id:wegameParams.rail_game_id,lang:wegameParams.lang,scope:wegameParams.scope,redirect_uri:wegameParams.redirect_uri};milo.cookie.set("milo_wegame_domain",location.protocol+"//"+location.host,0,"qq.com","/");loginUrl+="&"+milo.serialize(loginOpt);wegameFrame.show(loginUrl)};LoginManager.refreshWegame=function(successCallback,failCallback){var refresh_token=milo.cookie.get("refresh_token");var appid=milo.cookie.get("appid");var acctype=milo.cookie.get("acctype");if(!refresh_token||!appid||"wg"!=acctype){isFunction(failCallback)&&failCallback("\u62b1\u6b49\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\u3002");return}var loginUrl=comm.getCheckLoginUrl();var wegameRefreshCbName="wegameRefresh_"+Math.ceil(1e4*Math.random());window[wegameRefreshCbName]=function(retObj){if(0==retObj.errorCode&&retObj.isLogin){var expires_in=retObj.expires_in||3600;milo.cookie.set("openid",retObj.openid,expires_in,location.host,"/");milo.cookie.set("access_token",retObj.access_token,expires_in,location.host,"/");milo.cookie.set("refresh_token",retObj.refresh_token,86400,location.host,"/");var logInfo={openid:retObj.openid,nickName:retObj.nickName,userLoginTime:retObj.userLoginTime,loginType:"wg",expires:86400};var value=milo.serialize(logInfo);milo.cookie.set("IED_LOG_INFO2_WG",value,0,location.host,"/");isFunction(successCallback)&&successCallback()}else{isFunction(failCallback)&&failCallback(retObj.errorStr)}};var params={appid:appid,acctype:acctype,refresh_token:refresh_token,callback:wegameRefreshCbName};milo.loginStatus.clearAME(function(){loadScript(loginUrl+"?"+milo.serialize(params),function(){})})};LoginManager.login=function(callback,opt){var ptOption={appid:"",target:"top",s_url:""};var logOption={gameId:"",appId:"",needMaskDiv:true,needReloadPage:true,loginDivOffset:{left:.5,top:.5},msg:"\u6b63\u5728\u83b7\u53d6\u767b\u5f55\u4fe1\u606f\uff0c\u8bf7\u7a0d\u5019...",loginedCallback:null,type:"float",loginFrame:"loginHTMLFrame",css:"",s_url:"",iUseQQConnect:1};if(typeof callback!="function"&&typeof callback=="object"){opt=callback;callback=null}extendLess(logOption,option);extend(logOption,opt);if(logOption.iUseQQConnect){return this.qcLogin(callback,opt)}if(typeof opt=="object"&&opt.needReloadPage){logOption.needReloadPage=opt.needReloadPage}else{logOption.needReloadPage=isFunction(callback)?false:logOption.needReloadPage}logOption.gameId=!logOption.gameId?comm.getGameId():logOption.gameId;ptOption.appid=!logOption.appId?comm.getAppId(logOption.gameId):logOption.appId;ptOption.s_url=!logOption.s_url?comm.getS_URL(logOption.needReloadPage):logOption.s_url;ptOption.target=logOption.needReloadPage?"top":"self";ptOption.style=logOption.style?logOption.style:"20";if(ptOption.style!=20||ptOption.style!=21||ptOption.style!=32||ptOption.style!=33){ptOption.style=20}ptOption.daid=8;if(!logOption.needReloadPage){window["LoginedCallback"]=function(){var callbackName="jsonp"+milo.randomInt(100);comm.callbackLoginInfo(callbackName,function(IED_LOG_INFO2){if(logOption.type=="inner"){$("#milo_login_close").trigger("click")}else{Dialog.hide()}var isLogin=comm.checkUserLogined();if(isLogin){cb.loginedCallback();if(isFunction(callback))callback()}else{cb.unloginCallback()}});var acctype=milo.request("acctype")||milo.cookie.get("acctype");var appid=milo.request("appid");var openid=milo.request("openid");var access_token=milo.request("acctype")=="wx"?milo.request("access_token"):milo.request("openkey");if("qc"==acctype){appid=appid||milo.cookie.get("appid");

openid=openid||milo.cookie.get("openid");access_token=access_token||milo.cookie.get("access_token")}if(acctype){milo.loginStatus.clearAME(function(){loadScript(comm.getCheckLoginUrl(option.gameId)+"?callback="+callbackName+"&acctype="+acctype+"&appid="+appid+"&openid="+openid+"&access_token="+access_token+"&game="+comm.getGameId(),function(loaded){})})}else{milo.loginStatus.clearAME(function(){loadScript(comm.getCheckLoginUrl(option.gameId)+"?callback="+callbackName+"&game="+comm.getGameId(),function(loaded){})})}}}var acctype=milo.cookie.get("acctype")?milo.cookie.get("acctype"):milo.request("acctype");if(acctype&&"qc"!=acctype){}else{if(logOption.type=="float"){logOption.src="https://xui.ptlogin2.qq.com/cgi-bin/xlogin?proxy_url="+location.protocol+"//game.qq.com/comm-htdocs/milo/proxy.html&"+milo.serialize(ptOption);logWin.openLoginDiv(logOption);Dialog.show({id:"loginDiv",bgcolor:"#E6F5FF",PopzIndex:100002})}else if(logOption.type=="inner"){ptOption.hide_close_icon=1;g(logOption.loginFrame).src="https://xui.ptlogin2.qq.com/cgi-bin/xlogin?proxy_url="+location.protocol+"//game.qq.com/comm-htdocs/milo/proxy.html&"+milo.serialize(ptOption)}else{ptOption.style=1;ptOption.hide_title_bar=1;ptOption.hide_close_icon=1;if(logOption.css){ptOption.css=logOption.css}g(logOption.loginFrame).src="https://xui.ptlogin2.qq.com/cgi-bin/xlogin?proxy_url="+location.protocol+"//game.qq.com/comm-htdocs/milo/proxy.html&"+milo.serialize(ptOption)}}};LoginManager.loginByWxAndQc=function(opt,callback){var logOption={topTips:"\u5fae\u4fe1\u548cQQ\u662f\u4e24\u4e2a\u72ec\u7acb\u8d26\u53f7\uff0c\u8d26\u53f7\u4fe1\u606f\u4e0d\u4e92\u901a"};extend(logOption,opt);var qcUrl=this.qcLogin(callback,opt,true);opt.isQcWx=true;qcWxFrame.show(qcUrl,opt,logOption)};LoginManager.loginByWXAndQQ=function(opt,callback){var logOption={topTips:"\u5fae\u4fe1\u548cQQ\u662f\u4e24\u4e2a\u72ec\u7acb\u8d26\u53f7\uff0c\u8d26\u53f7\u4fe1\u606f\u4e0d\u4e92\u901a"};var logOption2={topTips:"\u5fae\u4fe1\u548cQQ\u662f\u4e24\u4e2a\u72ec\u7acb\u8d26\u53f7\uff0c\u8d26\u53f7\u4fe1\u606f\u4e0d\u4e92\u901a"};extend(logOption2,option);extend(logOption2,opt);if(logOption2.iUseQQConnect){this.loginByWxAndQc(opt,callback);return}logOption.isQqWx=true;extend(logOption,opt);var option1=option;var loginCss='<style type="text/css" id="milo_login_css_win">';loginCss+=" .milo_login_dialog ol, ul {list-style: none;}";loginCss+=" .milo_login_dialog { background: #fff;font: 12px/1.5 hiragino sans gb,microsoft yahei,simsun;}";loginCss+=" .milo_login_dialog a, .milo_login_dialog a:hover { text-decoration: none; }";loginCss+=" .milo_login_dialog .milo_btn_close {display: block;position: absolute;top: 1px;right: 1px;width: 47px;height: 28px;background: url(https://vm.gtimg.cn/tencentvideo/vstyle/web/common/style/img/login/sprite_login.png?d=0210&max_age=31104000) 0 0 no-repeat;z-index: 10;}";loginCss+=" .milo_login_dialog .milo_btn_close .milo_btn_inner {	display: none;}";loginCss+=" .milo_login_dialog .milo_login_tab { position: relative;height: 50px;margin-bottom: -1px;border-bottom: 1px solid #e6e6e6;background: #f1f1f1;font-size: 0;z-index: 3;}";loginCss+=" .milo_login_dialog ul, .milo_login_dialog li, .milo_login_dialog p {	padding: 0;	margin: 0;}";loginCss+=".milo_login_dialog .milo_login_tab .milo_list_item {display: inline-block;*display:inline;zoom: 1;width: 50%;text-align: center;}";loginCss+=".milo_login_dialog .milo_login_tab .milo_list_item .milo_tab_item { display: block;width: 100%;height: 50px;line-height: 50px;font-size: 16px;color: #b1b1b1;}";loginCss+=".milo_login_dialog .milo_login_tab .milo_current .milo_tab_item {	height: 51px;margin-bottom: -1px;color: #fff;}";loginCss+=".milo_login_dialog .milo_login_tab .milo_current .milo_tab_item_qq { background: #31a4f6;}";loginCss+=".milo_login_dialog .milo_login_tab .milo_list_item .ico_loginqq, .milo_login_dialog .milo_login_tab .milo_list_item .milo_ico_loginwx { display: inline-block;*display:inline;zoom: 1;background: url(https://vm.gtimg.cn/tencentvideo/vstyle/web/common/style/img/login/sprite_login.png?d=0210&max_age=31104000) 9999px 9999px no-repeat;vertical-align: top;position: relative;top: 12px;*top:0px;margin-right: 8px;}";loginCss+=".milo_login_dialog .milo_login_cont .milo_cont_inner_qq, .milo_login_dialog .milo_login_cont .milo_cont_inner_wx { display: none; }";loginCss+=" .milo_login_dialog .milo_login_tab .milo_list_item .ico_loginqq {width: 20px;height: 23px;background-position: -180px -90px;}";loginCss+=" .milo_login_dialog .milo_login_tab .milo_list_item.milo_current .ico_loginqq {background-position: -200px -90px;}";loginCss+=" .milo_login_dialog .milo_login_tab .milo_list_item .milo_ico_loginwx { width: 24px;height: 23px;background-position: -220px -90px;}";loginCss+=" .milo_login_dialog .milo_login_tips { position: relative;z-index: 3;height: 22px;padding: 12px 10px;}";loginCss+=" .milo_login_dialog .milo_login_tips .milo_tips_txt {font-size: 14px;line-height: 22px;color: #a2a2a2;text-align: center;zoom: 1;}";loginCss+=" .milo_login_dialog .milo_login_cont {	position: relative;height: 400px;z-index: 2;	overflow: hidden;background: #fff;}";loginCss+=" .milo_mask_layer {position: fixed;_position: absolute;top: 0;left: 0;z-index: 999;width: 100%;height: 100%;background: #000;filter: alpha(opacity=50);opacity: .5;}";loginCss+=" .milo_login_dialog .milo_login_cont .milo_cont_inner_in {display: block;}";loginCss+=" .milo_login_dialog .milo_login_iframe { width: 100%;height: 100%;margin: -2px 0 0 -2px;}";loginCss+=' .milo_login_dialog .milo_login_iframe .iframe_title { display: block;height: 50px;text-align: center;font-size: 14px;font-weight: 700;font-family: "hiragino sans gb",simsun,stfangsong;color: #808080;}';loginCss+=" .milo_login_dialog .milo_login_iframe_wx .iframe_title { padding-top: 50px;}";loginCss+=" .milo_login_dialog .milo_login_tab .milo_current .milo_tab_item_wx {background: #4ab218;}";loginCss+="</style>";var loginHtml='<div id="milo_login_win" class="milo_login_dialog" style="display: block; width: 622px; height: 418px; top: 50%; left: 50%; margin-left: -311px; margin-top: -209px; position: fixed; z-index: 10001; padding: 0px; background-color: rgb(255, 255, 255);">';loginHtml+='<a href="javascript:void(0)" id="milo_login_close" class="milo_btn_close" title="\u5173\u95ed">';loginHtml+='<span class="milo_btn_inner">\u5173\u95ed</span></a>';loginHtml+='<div class="milo_login_tab">';loginHtml+='<ul class="milo_tab_list">';loginHtml+='<li class="milo_list_item milo_list_item_qq" data-type="qq">';loginHtml+='<a href="javascript:void(0);" class="milo_tab_item milo_tab_item_qq">';loginHtml+='<i class="ico_loginqq"></i><span>QQ\u8d26\u53f7\u767b\u5f55</span>';loginHtml+="</a>";loginHtml+="</li>";loginHtml+='<li class="milo_list_item milo_list_item_wx" data-type="wx"><a href="javascript:void(0);" class="milo_tab_item milo_tab_item_wx">';loginHtml+='<i class="milo_ico_loginwx"></i>';loginHtml+="<span>\u5fae\u4fe1\u8d26\u53f7\u767b\u5f55</span>";loginHtml+="</a>";loginHtml+="</li>";loginHtml+="</ul>";loginHtml+="</div>";loginHtml+='<div class="milo_login_tips">';loginHtml+='<div class="milo_tips_txt">'+logOption.topTips+"</div>";loginHtml+="</div>";loginHtml+='<div class="milo_login_cont">';loginHtml+='<div class="milo_cont_inner milo_cont_inner_qq">';loginHtml+='<div class="milo_login_iframe">';loginHtml+='<iframe name="milo_login_frame_quick_" id="milo_login_frame_quick_" frameborder="no" scrolling="no" style="width:626px; height:400px;">';loginHtml+="</iframe>";loginHtml+="</div>";loginHtml+="</div>";loginHtml+='<div class="milo_cont_inner milo_cont_inner_wx">';loginHtml+='<div class="milo_login_iframe milo_login_iframe_wx">';loginHtml+='<div id="miloLoginWX" style="text-align: center;"></div>';loginHtml+="</div>";loginHtml+="</div>";loginHtml+="</div>";loginHtml+="</div>";loginHtml+='<div class="milo_mask_layer"></div>';function showQQPanel(){if($(".milo_list_item_qq").hasClass("milo_current")){$(".milo_list_item_qq").removeClass("milo_current");$(".milo_cont_inner_qq").removeClass("milo_cont_inner_in")}else{var initqq={type:"inner",loginFrame:"milo_login_frame_quick_"};if(logOption.loginedDiv!=undefined&&logOption.loginedDiv!=""){option1.loginedDiv=logOption.loginedDiv}if(logOption.unloginDiv!=undefined&&logOption.unloginDiv!=""){option1.unloginDiv=logOption.unloginDiv}if(logOption.userinfoSpan!=undefined&&logOption.userinfoSpan!=""){option1.userinfoSpan=logOption.userinfoSpan}LoginManager.login(function(){if(typeof callback=="function"){callback()}},{type:"inner",loginFrame:"milo_login_frame_quick_",needReloadPage:option1.needReloadPage?option1.needReloadPage:true});$(".milo_list_item_qq").addClass("milo_current");$(".milo_cont_inner_qq").addClass("milo_cont_inner_in")}}var winContent=function(){if(document.getElementById("milo_login_win")!=null){return}$("body").append(loginCss+loginHtml);showQQPanel();$(".milo_tab_list li").bind("click",function(e){if(!$(this).hasClass("milo_current")){showQQPanel();if($(".milo_list_item_wx").hasClass("milo_current")){$(".milo_list_item_wx").removeClass("milo_current");$(".milo_cont_inner_wx").removeClass("milo_cont_inner_in")}else{LoginManager.loginByWx(extend({innerStyle:true,innerParentId:"miloLoginWX"},logOption));$(".milo_list_item_wx").addClass("milo_current");$(".milo_cont_inner_wx").addClass("milo_cont_inner_in")}}});$("#milo_login_close").bind("click",function(){$("#milo_login_win").remove();$("#milo_mask_layer").remove();$("#milo_login_css_win").remove()})};if(typeof jQuery!="undefined"){winContent()}else{need(["util.jquery"],function($){winContent()})}};LoginManager.logout=function(callback,opt){var logOption={freshWin:"",jumpUrl:"",needMaskDiv:true,showTip:true,msg:"\u4eb2\u7231\u7684\u7528\u6237\uff0c\u60a8\u5df2\u7ecf\u6ce8\u9500\u6210\u529f\uff01",loginDivOffset:{left:.5,top:.5}};extendLess(logOption,option);extendLess(logOption,opt);if(logOption.showTip!==false){Dialog.show({sMsg:"\u4eb2\u7231\u7684\u7528\u6237\uff0c\u60a8\u5df2\u7ecf\u6ce8\u9500\u6210\u529f",sStyle:"margin:0px;padding:0px;width:250px;height:40px;border:2px solid buttonface;background-color:#FFFFCC;font-size:12px;color:#000;text-align:center;line-height: 40px; ",bgcolor:"#E6F5FF"})}milo.cookie.clear("IED_LOG_INFO2","qq.com","/");milo.cookie.clear("openid","qq.com","/");milo.cookie.clear("access_token","qq.com","/");milo.cookie.clear("appid","qq.com","/");milo.cookie.clear("acctype","qq.com","/");milo.cookie.clear("wxcode","qq.com","/");milo.cookie.clear("IED_LOG_INFO2",location.host,"/");milo.cookie.clear("IED_LOG_INFO2_QC",location.host,"/");milo.cookie.clear("IED_LOG_INFO2_WG",location.host,"/");milo.cookie.clear("openid",location.host,"/");milo.cookie.clear("access_token",location.host,"/");milo.cookie.clear("refresh_token",location.host,"/");milo.cookie.clear("appid",location.host,"/");milo.cookie.clear("acctype",location.host,"/");milo.cookie.clear("wxcode",location.host,"/");var logoutCallbackLock=2;window["logoutWxCallback"]=window["logoutCallback"]=function(){logoutCallbackLock--;cb.unloginCallback();if(isFunction(callback)&&0==logoutCallbackLock){callback()}if(logOption.showTip!==false){Dialog.hide()}if(logOption.freshWin){if(logOption.jumpUrl){window[logOption.freshWin].location.href=logOption.jumpUrl}else{window[logOption.freshWin].location.reload()}}};var oWxIFrame=document.createElement("iframe");oWxIFrame.id="loginWxIframe";oWxIFrame.name="loginWxIframe";oWxIFrame.scrolling="no";oWxIFrame.frameBorder="0";oWxIFrame.style.display="none";document.body.appendChild(oWxIFrame);oWxIFrame.src=location.protocol+"//apps.game.qq.com/ams/logout_wx.html";logWin.openLoginDiv({src:location.protocol+"//game.qq.com/act/logout.html?20121029"})};LoginManager.checkLogin=function(logincallback,unlogincallback,opt){option=extend(option,opt);if(comm.checkUserLogined()){cb.loginedCallback();if(isFunction(logincallback)){if(!milo.cookie.get("wxcode")){var user={uin:comm.getUserUin(),nickname:comm.getNickName(),logtype:milo.cookie.get("acctype")||"qq",openid:milo.cookie.get("openid")||""};if("qc"==user.logtype&&1!=option.iUseQQConnect){user.logtype="pt";user.openid=""}if(/^(qc|wg)$/.test(user.logtype)){user.face=comm.getUserFaceData(user.openid)}logincallback(user)}else{LoginManager.wxRenderWhenLogined(logincallback)}}}else{var callbackName="jsonp"+milo.randomInt(100);comm.callbackLoginInfo(callbackName,function(IED_LOG_INFO2){var isLogin=comm.checkUserLogined();LoginManager._______isRunFirstMilo=0;if(isLogin){cb.loginedCallback();if(isFunction(logincallback)){if(!milo.cookie.get("wxcode")){var user={uin:comm.getUserUin(),nickname:comm.getNickName(),logtype:IED_LOG_INFO2.loginType||milo.cookie.get("acctype")||"qq",face:IED_LOG_INFO2.face||""};if("qc"==user.logtype){user.openid=milo.cookie.get("openid")||""}if("wg"==user.logtype){user.openid=milo.cookie.get("openid")||""}if(user.face&&/^(qc|wg)$/.test(user.logtype)){comm.storeUserFace(user.openid,user.face)}logincallback(user)}else{}}}else{cb.unloginCallback();if(isFunction(unlogincallback))unlogincallback()}while(true){if(LoginManager.logincallbackArray.length<=0){break}var temp=LoginManager.logincallbackArray.shift();temp(IED_LOG_INFO2)}LoginManager._______isRunFirstMilo=0});if(!LoginManager.logincallbackArray){LoginManager.logincallbackArray=[]}if(typeof LoginManager._______isRunFirstMilo=="undefined"){LoginManager._______isRunFirstMilo=0}if(LoginManager._______isRunFirstMilo!=0){LoginManager.logincallbackArray.push(window[callbackName]);return}LoginManager._______isRunFirstMilo=1;var acctype=milo.request("acctype");if(!acctype&&"qc"==milo.cookie.get("acctype")){acctype="qc"}if(!acctype&&"wg"==milo.cookie.get("acctype")){acctype="wg"}if(acctype=="weixin"){acctype="wx"}var appid=milo.request("appid");var openid=milo.request("openid");var access_token=acctype=="wx"?milo.request("access_token"):milo.request("openkey");if(location.host=="cfw.qq.com"){access_token=milo.request("access_token")}if("qc"==acctype){appid=appid||milo.cookie.get("appid");openid=openid||milo.cookie.get("openid");access_token=access_token||milo.cookie.get("access_token");if(option.iUseQQConnect!=1){appid="";openid="";access_token="";acctype=""}}if("wg"==acctype){appid=milo.cookie.get("appid")||"";access_token=milo.cookie.get("access_token")||"";openid=milo.cookie.get("openid")||"";refresh_token=milo.cookie.get("refresh_token")||"";milo.loginStatus.clearAME(function(){loadScript(comm.getCheckLoginUrl(option.gameId)+"?callback="+callbackName+"&acctype="+acctype+"&appid="+appid+"&openid="+openid+"&access_token="+access_token+"&refresh_token="+refresh_token,function(loaded){})})}else if(acctype){milo.loginStatus.clearAME(function(){loadScript(comm.getCheckLoginUrl(option.gameId)+"?callback="+callbackName+"&acctype="+acctype+"&appid="+appid+"&openid="+openid+"&access_token="+access_token+"&game="+comm.getGameId(),function(loaded){})})}else{var wxcode=milo.request("code");if(wxcode&&!milo.cookie.get("openid")){LoginManager.doWxCodeToOpenId(wxcode,function(openidInfo){var originalUrl=decodeURIComponent(milo.request("originalUrl"));if(isFunction(parent.milo_WxLoginCallback)){parent.milo_WxLoginCallback()}else{if(milo.xss.isSafeUrl(originalUrl)){document.location.href=originalUrl}}})}else if(milo.cookie.get("wxcode")){LoginManager._______isRunFirstMilo=0;LoginManager.wxRenderWhenLogined(logincallback)}else{milo.loginStatus.clearAME(function(){loadScript(comm.getCheckLoginUrl(option.gameId)+"?callback="+callbackName+"&game="+comm.getGameId(),function(loaded){})})}}}};LoginManager.wxRenderWhenLogined=function(logincallback){var openId=milo.cookie.get("openid");var access_token=milo.cookie.get("access_token");LoginManager.getUserInfoByWxOpenId({openid:openId,access_token:access_token},function(wxUserInfo){if(isFunction(logincallback)&&wxUserInfo){wxUserInfo.logtype="wx";LoginManager.wxUserInfo=wxUserInfo;if(isDom(g(option.loginedDiv))){g(option.loginedDiv).style.display="block"}if(isDom(g(option.unloginDiv))){g(option.unloginDiv).style.display="none"}if(isDom(g(option.userinfoSpan))){g(option.userinfoSpan).innerHTML=milo.xss.filterWxNickName(wxUserInfo.nickname)}logincallback(wxUserInfo)}});var callbackName="jsonp"+milo.randomInt(100);window[callbackName]=function(IED_LOG_INFO2){if(IED_LOG_INFO2.isLogin){var loginInfo=milo.cookie.get("IED_LOG_INFO2");if(loginInfo){loginInfo=milo.unSerialize(loginInfo)}else{loginInfo={}}if(IED_LOG_INFO2.loginType=="qq"||IED_LOG_INFO2.loginType=="wx"){loginInfo.userUin=IED_LOG_INFO2.openid}else{loginInfo.userUin=IED_LOG_INFO2.userUin}loginInfo.nickName=IED_LOG_INFO2.nickName;loginInfo.userLoginTime=IED_LOG_INFO2.userLoginTime;var value=milo.serialize(loginInfo);milo.cookie.set("IED_LOG_INFO2",value,0,"qq.com","/")}else{comm.clearLOG_INFO_2()}var __tointer=1;if(comm.getCheckLoginUrl(comm.getGameId()).indexOf("//commwebgame.game.qq.com/comm-cgi-bin/login/LoginReturnInfo.cgi")>-1){__tointer=2}else if(comm.getCheckLoginUrl(comm.getGameId()).indexOf("//ams.game.qq.com/ams/userLoginSvr")>-1){__tointer=3}ATM.reportATM({toappid:1,tomoduletype:100,tointer:__tointer,toreturncode:IED_LOG_INFO2.errorCode==0?0:1,businesstype:comm.getGameId(),result:IED_LOG_INFO2.errorCode,cgi:location.href,errormsg:IED_LOG_INFO2.errorStr})};option.logtype=3;milo.loginStatus.clearAME(function(){loadScript(comm.getCheckLoginUrl(option.gameId)+"?callback="+callbackName,function(loaded){})})};LoginManager.doWxCodeToOpenId=function(wxcode,callback){var serviceType=milo.request("sServiceType");var appid=milo.request("appid");var wxcodeToOpenidUrl=location.protocol+"//apps.game.qq.com/ams/ame/codeToOpenId.php?appid="+appid+"&wxcode="+wxcode+"&sServiceType="+serviceType+"&wxcodedomain="+window.location.host+"&acctype=wx";var doCodeToOpenID=function(){$.ajax(wxcodeToOpenidUrl,{dataType:"jsonp",success:function(objData){if(objData.iRet===0){var openidInfo=$.parseJSON(objData.sMsg);milo.cookie.set("wxcode",wxcode,0,"qq.com","/");milo.cookie.set("openid",openidInfo.openid,0,"qq.com","/");milo.cookie.set("access_token",openidInfo.access_token,0,"qq.com","/");milo.cookie.set("acctype","wx",0,"qq.com","/");milo.cookie.set("appid",appid,0,"qq.com","/");if(isFunction(callback)){callback(openidInfo)}ATM.reportATM({toappid:1,tomoduletype:32,tointer:2,toreturncode:0,businesstype:comm.getGameId(),result:objData.iRet,serialnum:objData.sLogSerialNum,cgi:location.href,errormsg:objData.sMsg})}else{alert("\u83b7\u53d6\u767b\u5f55\u6001\u5931\u8d25!");if(isFunction(callback)){callback(openidInfo)}ATM.reportATM({toappid:1,tomoduletype:32,tointer:2,toreturncode:1,businesstype:comm.getGameId(),result:objData.iRet,serialnum:objData.sLogSerialNum,cgi:location.href,errormsg:objData.sMsg});return}},error:function(xhr,errInfo,errObj){if(xhr.status!=200){ATM.reportATM({toappid:1,tomoduletype:32,tointer:1,toreturncode:1,businesstype:comm.getGameId(),result:0-xhr.status,serialnum:"",cgi:location.href,errormsg:xhr.statusText})}else{var errormsg="";if(errInfo){errormsg+=errInfo.toString()}if(errObj){errormsg+="("+errObj.message+")"}ATM.reportATM({toappid:1,tomoduletype:32,tointer:1,toreturncode:1,businesstype:comm.getGameId(),result:0-xhr.status,serialnum:"",cgi:location.href,errormsg:errormsg})}}})};if(typeof jQuery!="undefined"){doCodeToOpenID()}else{need(["util.jquery"],function($){doCodeToOpenID()})}};LoginManager.wxUserInfoRequestQueue={queueList:{},isWaiting:function(openid,access_token){var k=openid+"-"+access_token;return this.queueList[k]&&this.queueList[k].length},add:function(openid,access_token,callback){var k=openid+"-"+access_token;if(!this.queueList[k]){this.queueList[k]=[callback]}else{this.queueList[k].push(callback)}},run:function(openid,access_token,userInfo){var cbArr=this.queueList[openid+"-"+access_token];while(cbArr&&cbArr.length){var cb=cbArr.shift();if("function"==typeof cb){cb(userInfo)}}}};LoginManager.getUserInfoByWxOpenId=function(opt,callback){var self=this;var wxuserapi_url=location.protocol+"//apps.game.qq.com/ams/ame/getWXUser.php?access_token="+opt.access_token+"&openid="+opt.openid;var emojicss=location.protocol+"//ossweb-img.qq.com/images/js/milo/biz/widget/emoji/emoji.css";var doGetUserInfo=function(){if(self.wxUserInfoRequestQueue.isWaiting(opt.openid,opt.access_token)){self.wxUserInfoRequestQueue.add(opt.openid,opt.access_token,callback);return}self.wxUserInfoRequestQueue.add(opt.openid,opt.access_token,callback);$.ajax(wxuserapi_url,{dataType:"jsonp",success:function(wxUserData){if(wxUserData.iRet===0){var userinfo=wxUserData.data;comm.storeWxUserInfo(opt.openid,opt.access_token,userinfo);if($("head").find("link[href='"+emojicss+"']").length==0){loadCSS(emojicss,function(){self.wxUserInfoRequestQueue.run(opt.openid,opt.access_token,userinfo)})}else{self.wxUserInfoRequestQueue.run(opt.openid,opt.access_token,userinfo)}ATM.reportATM({toappid:1,tomoduletype:32,tointer:3,toreturncode:0,businesstype:comm.getGameId(),result:wxUserData.iRet,serialnum:wxUserData.sLogSerialNum||"",cgi:location.href,errormsg:wxUserData.sMsg})}else{ATM.reportATM({toappid:1,tomoduletype:32,tointer:3,toreturncode:1,businesstype:comm.getGameId(),result:wxUserData.iRet,serialnum:wxUserData.sLogSerialNum||"",cgi:location.href,errormsg:wxUserData.sMsg});LoginManager.logout()}},error:function(xhr,errInfo,errObj){if(xhr.status!=200){ATM.reportATM({toappid:1,tomoduletype:32,tointer:3,toreturncode:1,businesstype:comm.getGameId(),result:0-xhr.status,serialnum:"",cgi:location.href,errormsg:xhr.statusText})}else{var errormsg="";if(errInfo){errormsg+=errInfo.toString()}if(errObj){errormsg+="("+errObj.message+")"}ATM.reportATM({toappid:1,tomoduletype:32,tointer:3,toreturncode:1,businesstype:comm.getGameId(),result:0-xhr.status,serialnum:"",cgi:location.href,errormsg:errormsg})}}})};if(opt.openid&&opt.access_token&&comm.getWxUserInfo(opt.openid,opt.access_token)){callback&&callback(comm.getWxUserInfo(opt.openid,opt.access_token));return}if(typeof jQuery!="undefined"){doGetUserInfo()}else{need(["util.jquery"],function($){doGetUserInfo()})}};LoginManager.loginByWx=function(opt){var self=this;if(!opt.serviceType){opt.serviceType=comm.getGameId()}if(!opt.serviceType){opt.serviceType=comm.getGameId()}var url=location.protocol+"//"+(opt.gameDomain||location.host)+"/comm-htdocs/milo_mobile/wxlogin.html";var originalUrl=opt.originalUrl||document.location.href;url=url+"?appid="+opt.appId+"&sServiceType="+opt.serviceType+"&originalUrl="+encodeURIComponent(originalUrl);var option={id:"ams_container_wxlogin",appid:opt.appId,scope:"snsapi_login",redirect_uri:encodeURIComponent(url),state:"1",style:"black",href:"",self_redirect:true};var openWxDiv=function(){var createPopDiv=function(){var $box=$("<div id='ams_loginWxDiv' ></div>");$box.css({width:"300px",height:"460px",border:"1px solid #ccc",padding:"0px 20px",margin:"0px",position:"absolute",zIndex:"100002",top:"20%",left:"30%",display:"none","background-color":"#fff"});$container=$("<div id='ams_container_wxlogin' ></div>");$closebtn=$("<span id='ams_btn_closebtn' >\xd7</span>");$closebtn.css({"float":"right",height:"40px",width:"40px","line-height":"36px","text-align":"40px","text-align":"center","font-size":"30px","margin-right":"-20px",cursor:"pointer",color:"#666","font-family":"Verdana,sans-serif"}).on("mouseenter",function(){$(this).css({color:"#000"})}).on("mouseleave",function(){$(this).css({color:"#666",fontWeight:""})}).on("click",function(){need(["biz.dialog"],function(Dialog){Dialog.hide({id:"ams_loginWxDiv"});$box.remove()})});$box.append($closebtn).append($container);$("body").append($box)};if(typeof jQuery!="undefined"){if(opt.innerStyle){loadScript(location.protocol+"//res.wx.qq.com/connect/zh_CN/htmledition/js/wxLogin.js",function(loaded){option.id=opt.innerParentId;var wxloginobj=new WxLogin(option)})}else{createPopDiv();loadScript(location.protocol+"//res.wx.qq.com/connect/zh_CN/htmledition/js/wxLogin.js",function(loaded){need(["biz.dialog"],function(Dialog){Dialog.show({id:"ams_loginWxDiv",bgcolor:"#E6F5FF"});var wxloginobj=new WxLogin(option)})})}}else{need(["util.jquery"],function($){if(opt.innerStyle){loadScript(location.protocol+"//res.wx.qq.com/connect/zh_CN/htmledition/js/wxLogin.js",function(loaded){option.id=opt.innerParentId;var wxloginobj=new WxLogin(option)})}else{createPopDiv();loadScript(location.protocol+"//res.wx.qq.com/connect/zh_CN/htmledition/js/wxLogin.js",function(loaded){need(["biz.dialog"],function(Dialog){Dialog.show({id:"ams_loginWxDiv",bgcolor:"#E6F5FF"});var wxloginobj=new WxLogin(option)})})}})}};openWxDiv();window.milo_WxLoginCallback=function(){if(opt.isQcWx){qcWxFrame.close()}else if(opt.isQqWx){$("#milo_login_win").remove();$("#milo_mask_layer").remove();$("#milo_login_css_win").remove()}else{need(["biz.dialog"],function(Dialog){Dialog.hide({id:"ams_loginWxDiv"});$("#ams_loginWxDiv").remove()})}if(isFunction(opt.callback)){self.checkLogin(function(userinfo){opt.callback(userinfo)},function(){opt.callback(false)})}else{location.href=originalUrl}}};LoginManager.getNickName=function(callback){var getUserOption={isLogin:false,nickName:""},loginInfo=milo.cookie.get("IED_LOG_INFO2");if(option.iUseQQConnect&&"qc"==milo.cookie.get("acctype")){loginInfo=milo.cookie.get("IED_LOG_INFO2_QC")}LoginManager.checkLogin(function(){if(loginInfo){loginInfo=milo.unSerialize(loginInfo);if(loginInfo.nickName){getUserOption={isLogin:true,nickName:decodeURIComponent(loginInfo.nickName)||""};if(isFunction(callback)){callback(getUserOption);return}}}else{getUserOption.isLogin=true;if(isFunction(callback)){callback(getUserOption);return}}},function(){if(isFunction(callback)){callback(getUserOption);return}})};LoginManager.getUserVip=function(gameId,callback){gameId=gameId||"";gameId=gameId.toLowerCase();var VIPMAP={cf:true,xx:true,ava:true,roco:true,qq:true};if(gameId&&VIPMAP[gameId]){need("util.uservip",function(Vip){LoginManager.checkLogin(function(){Vip["get"+gameId.toUpperCase()+"Vip"](callback)},function(){var vip_obj=Vip.getVIPObj();if(typeof callback=="function"){callback(vip_obj)}})})}};LoginManager.getUserDiamond=function(gameId,callback){gameId=gameId||"";gameId=gameId.toLowerCase();var DIAMONDMAP={qqgame:true,speed:true,qqshow:true,qqzone:true,r2:true,qqtang:true,x5:true,dnf:true};if(gameId&&DIAMONDMAP[gameId]){need("util.userdiamond",function(Diamond){LoginManager.checkLogin(function(){Diamond["get"+gameId.toUpperCase()+"Diamond"](callback)},function(){var diamond_obj=Diamond.getDiamondObj();if(typeof callback=="function"){callback(diamond_obj)}})})}};LoginManager.getUserDiamond.getDiamondObj=function(){var obj={isLogin:false,isVip:false,isSuperVip:false,vipLevel:-1,isYearVip:false,errorInfo:""};return obj};LoginManager.submitLogin=function(callback){if(!isFunction(callback)){callback=function(){}}LoginManager.checkLogin(function(){callback()},function(){LoginManager.login(function(){cb.loginedCallback();callback()})})};LoginManager.reloadLogin=function(callback,unLoginCallback){if(!isFunction(callback)){callback=function(){}}if(!isFunction(unLoginCallback)){unLoginCallback=function(){location.reload()}}LoginManager.checkLogin(function(){callback()},function(){LoginManager.login(function(){unLoginCallback()})})};function ptlogin2_onResize(width,height){var login_wnd=logWin.getLoginDiv();if(login_wnd){login_wnd.style.width=width+"px";login_wnd.style.height=height+"px";login_wnd.style.visibility="hidden";login_wnd.style.visibility="visible"}}try{if(ptlogin2_onClose_v3&&isFunction(ptlogin2_onClose_v3)&&g("_overlay_")&&g("_overlay_").style.display!="block"){var ptlogin2_onClose=ptlogin2_onClose_v3;Dialog.hide()}else{var ptlogin2_onClose=function(){Dialog.hide()}}}catch(e){var ptlogin2_onClose=function(){Dialog.hide()}}window["ptlogin2_onClose"]=ptlogin2_onClose;window["ptlogin2_onResize"]=ptlogin2_onResize;if(typeof window.postMessage!=="undefined"){window.onmessage=function(event){var msg=event||window.event;if(msg.origin=="https://xui.ptlogin2.qq.com"){var data;if(typeof JSON!=="undefined")data=JSON.parse(msg.data);else data=str2JSON(msg.data);switch(data.action){case"close":ptlogin2_onClose();break;case"resize":ptlogin2_onResize(data.width,data.height);break;default:break}}}}function str2JSON(str){eval("var __pt_json="+str);return __pt_json}LoginManager.init=function(opt){option=extend(option,opt);if(1==option.iUseQQConnect){window.iUseQQConnect=1}option.gameId=!isObject(opt)||!opt.gameId?comm.getGameId():opt.gameId;option.appId=!option.appId?comm.getAppId(option.gameId):option.appId;if(comm.checkUserLogined()){cb.loginedCallback()}else{cb.unloginCallback()}};LoginManager.init();return LoginManager});